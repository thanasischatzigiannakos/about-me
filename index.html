<!DOCTYPE html>
<html lang="en">
  <head>
  	  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Athanasios Chatzigiannakos</title>
  <link rel="stylesheet" href="styles.css">
  </head>
  <body>
  <div id="terminal">
    <div id="toolbar">
      <label for="themeSelect">Theme:</label>
      <select id="themeSelect" aria-label="Theme selector">
        <option value="crt">CRT Green</option>
        <option value="amber">Amber Pulse</option>
        <option value="violet">Vector Violet</option>
        <option value="ice">Ice Blue</option>
      </select>
    </div>
    <div class="input-line">
      <span class="prompt">$</span>
      <input id="input" autofocus />
    </div>
  </div>

  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("input");
    const toolbar = document.getElementById("toolbar");
    const themeSelect = document.getElementById("themeSelect");
    const DEFAULT_THEME = "crt";

    const themes = {
      crt: {
        name: "CRT Green",
        vars: {
          "--bg": "#010701",
          "--bg-2": "#041004",
          "--panel": "rgba(4, 16, 4, 0.92)",
          "--border": "rgba(152, 255, 102, 0.35)",
          "--text": "#d8ffd0",
          "--muted": "#7ad27a",
          "--accent": "#9bff5d"
        }
      },
      amber: {
        name: "Amber Pulse",
        vars: {
          "--bg": "#1a0700",
          "--bg-2": "#280b00",
          "--panel": "rgba(32, 8, 0, 0.9)",
          "--border": "rgba(255, 191, 120, 0.35)",
          "--text": "#ffe1b3",
          "--muted": "#d68f4c",
          "--accent": "#ff9f43"
        }
      },
      violet: {
        name: "Vector Violet",
        vars: {
          "--bg": "#060013",
          "--bg-2": "#100024",
          "--panel": "rgba(12, 0, 30, 0.92)",
          "--border": "rgba(196, 140, 255, 0.32)",
          "--text": "#f3e9ff",
          "--muted": "#b58ae0",
          "--accent": "#c792ff"
        }
      },
      ice: {
        name: "Ice Blue",
        vars: {
          "--bg": "#01121d",
          "--bg-2": "#021e2f",
          "--panel": "rgba(2, 18, 32, 0.9)",
          "--border": "rgba(126, 190, 255, 0.35)",
          "--text": "#d6f1ff",
          "--muted": "#81aac7",
          "--accent": "#7cd3ff"
        }
      }
    };

    function applyTheme(key) {
      const theme = themes[key] || themes[DEFAULT_THEME];
      const root = document.documentElement.style;
      Object.entries(theme.vars).forEach(([k, v]) => root.setProperty(k, v));
      try { localStorage.setItem("terminal-theme", key); } catch {}
    }

    const commands = {
      help: "Available: about, projects, contact, clear",
      about: "I am Chatzigiannakos Athanasios. I have professional experience in backend development and cloud computing with experience in various programming languages including Java, Python and C# \nIn my personal projects, I enjoy tinkering with CLI tool development using Rust and customizing my Linux environment. \nI would love to be involved in open source projects and contribute to the community.",
      projects: "- Backend Development - Led the development of Java Spring Boot microservices and python cloud functions for an energy company\n- Telecommunications - Participated in the development and Integration of different systems for a telecom provider \n- Developed a desktop application for the IT department of a local factory using C# and WPF \n- Dissertation: Implemented and compared various deep learning models for text classification (specifically software classification) using Python and libraries such as TensorFlow and Scikit-learn.",
      contact: "Email: athanasioschatzigiannakos@gmail.com\nGitHub: https://github.com/thanasischatzigiannakos\nLinkedIn: www.linkedin.com/in/athanasios-chatzigiannakos",
      clear: "clear"
    };

    function printLine(text, { typing = true, speed = 20, isHtml = false } = {}) {
      const line = document.createElement("div");
      line.className = "line";
      terminal.insertBefore(line, input.parentElement);
      if (!typing || !text) {
        if (isHtml) {
          line.innerHTML = text || "";
          ensureSafeAnchors(line);
        } else {
        line.textContent = text || "";
        }
        return Promise.resolve();
      }
      return (isHtml ? typeHtml(line, text, speed) : typeText(line, text, speed))
        .then(() => { if (isHtml) ensureSafeAnchors(line); });
    }

    function typeText(el, text, speed = 20) {
      return new Promise(resolve => {
        let i = 0;
        const timer = setInterval(() => {
          el.textContent = text.slice(0, i + 1);
          i++;
          if (i >= text.length) {
            clearInterval(timer);
            resolve();
          }
        }, speed);
      });
    }


    function typeHtml(el, html, speed = 20) {
      return new Promise(resolve => {
        let i = 0;
        let out = "";
        const step = () => {
          if (i >= html.length) { el.innerHTML = out; resolve(); return; }
          if (html[i] === "<") {
            const end = html.indexOf(">", i);
            const tag = html.slice(i, end + 1);
            out += tag;
            el.innerHTML = out;
            i = end + 1;
            requestAnimationFrame(step);
          } else {
            out += html[i];
            el.innerHTML = out;
            i++;
            setTimeout(step, speed);
          }
        };
        step();
      });
    }

    function ensureSafeAnchors(scopeEl) {
      scopeEl.querySelectorAll("a").forEach(a => {
        if (!a.target) a.target = "_blank";
        a.rel = "noopener noreferrer";
      });
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function linkify(text) {
      let html = escapeHtml(text).replace(/\n/g, "<br>");
      // URLs with protocol
      html = html.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
      // URLs starting with www.
      html = html.replace(/(^|\s)www\.([^\s<]+)/g, '$1<a href="https://www.$2" target="_blank" rel="noopener noreferrer">www.$2</a>');
      // Emails
      html = html.replace(/([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/g, '<a href="mailto:$1">$1</a>');
      return html;
    }

    window.addEventListener("DOMContentLoaded", () => {
      const saved = (() => { try { return localStorage.getItem("terminal-theme"); } catch { return null; } })();
      const initial = (saved && themes[saved]) ? saved : DEFAULT_THEME;
      applyTheme(initial);
      if (themeSelect) themeSelect.value = initial;
      printLine("Boot sequence complete. Type 'help' for commands.", { typing: true, speed: 15 });
    });

    if (themeSelect) {
      themeSelect.addEventListener("change", () => {
        applyTheme(themeSelect.value);
      });
    }

    input.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        const val = input.value.trim().toLowerCase();
        const line = document.createElement("div");
        line.className = "line";
        line.textContent = `$ ${val}`;
        terminal.insertBefore(line, input.parentElement);

        if (commands[val]) {
          if (val === "clear") {
            terminal.innerHTML = "";
            if (toolbar) terminal.appendChild(toolbar);
            terminal.appendChild(input.parentElement);
          } else {
            const content = commands[val];
            const html = linkify(content);
            printLine(html, { typing: true, speed: 15, isHtml: true });
          }
        } else if (val) {
          printLine(`Command not found: ${val}`, { typing: true, speed: 15 });
        }

        input.value = "";
        window.scrollTo(0, document.body.scrollHeight);
      } else if (e.key === "Tab") {
        e.preventDefault();
        const current = input.value.trim();
        const all = Object.keys(commands);
        if (!current) return;
        const matches = all.filter(cmd => cmd.startsWith(current));
        if (matches.length === 1) {
          input.value = matches[0] + ""; 
        } else if (matches.length > 1) {
          const common = commonPrefix(matches);
          if (common.length > current.length) {
            input.value = common;
          }
          // show suggestions
          const suggestions = matches.join("    ");
          const suggestionLine = document.createElement("div");
          suggestionLine.className = "line";
          suggestionLine.textContent = suggestions;
          terminal.insertBefore(suggestionLine, input.parentElement);
        }
      }
    });

    function commonPrefix(list) {
      if (!list.length) return "";
      let prefix = list[0];
      for (let i = 1; i < list.length; i++) {
        const item = list[i];
        let j = 0;
        while (j < prefix.length && j < item.length && prefix[j] === item[j]) j++;
        prefix = prefix.slice(0, j);
        if (!prefix) break;
      }
      return prefix;
    }
  </script>
</body>
</html>
